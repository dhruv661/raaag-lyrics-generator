<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raaag AI Lyrics Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #9333ea;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [activeTab, setActiveTab] = useState('generate');
      const [styleGuide, setStyleGuide] = useState('');
      const [checklist, setChecklist] = useState('');
      const [exampleLyrics, setExampleLyrics] = useState([]);
      const [newExample, setNewExample] = useState({ title: '', lyrics: '', notes: '' });
      
      const [formData, setFormData] = useState({
        customerRequest: '',
        orderNumber: ''
      });
      
      const [generatedLyrics, setGeneratedLyrics] = useState('');
      const [isGenerating, setIsGenerating] = useState(false);
      const [lyricsHistory, setLyricsHistory] = useState([]);
      const [searchQuery, setSearchQuery] = useState('');
      const [feedbackModal, setFeedbackModal] = useState({ open: false, lyric: null, type: null });
      const [feedbackNotes, setFeedbackNotes] = useState('');
      const [feedbackTitle, setFeedbackTitle] = useState('');

      useEffect(() => {
        const saved = localStorage.getItem('raaagData');
        if (saved) {
          try {
            const data = JSON.parse(saved);
            setStyleGuide(data.styleGuide || '');
            setChecklist(data.checklist || '');
            setExampleLyrics(data.exampleLyrics || []);
            setLyricsHistory(data.lyricsHistory || []);
          } catch (e) {
            console.error('Error loading saved data:', e);
          }
        }
      }, []);

      useEffect(() => {
        const data = { styleGuide, checklist, exampleLyrics, lyricsHistory };
        localStorage.setItem('raaagData', JSON.stringify(data));
      }, [styleGuide, checklist, exampleLyrics, lyricsHistory]);

      const addExample = () => {
        if (newExample.title && newExample.lyrics) {
          setExampleLyrics([...exampleLyrics, { ...newExample, id: Date.now() }]);
          setNewExample({ title: '', lyrics: '', notes: '' });
        }
      };

      const deleteExample = (id) => {
        setExampleLyrics(exampleLyrics.filter(ex => ex.id !== id));
      };

      const generateLyrics = async () => {
        if (!formData.orderNumber || !formData.customerRequest) {
          alert('Please fill in both Order Number and Customer Request');
          return;
        }

        setIsGenerating(true);
        
        try {
          const prompt = `You are an expert lyrics writer for Raaag, creating personalized songs for special occasions.

# YOUR STYLE GUIDE
${styleGuide || 'Not yet defined - please add your style guide in Settings tab.'}

# QUALITY CHECKLIST
${checklist || 'Not yet defined - please add your checklist in Settings tab.'}

# REFERENCE EXAMPLES
${exampleLyrics.length > 0 ? exampleLyrics.map((ex, i) => `
Example ${i + 1}: ${ex.title}
${ex.lyrics}
${ex.notes ? `Notes: ${ex.notes}` : ''}
`).join('\\n---\\n') : 'No examples added yet.'}

# CUSTOMER REQUEST
${formData.customerRequest}

# TASK
Analyze the customer request above and create personalized song lyrics based on ALL the information provided. The customer may have mentioned:
- Occasion (birthday, anniversary, wedding, etc.)
- Names of people involved
- Their relationship
- Language preference (Hindi, English, Hinglish, Tamil, Telugu, Malayalam, etc.)
- Mood/tone (romantic, happy, emotional, upbeat, etc.)
- Musical style (Bollywood, pop, classical, etc.)
- Their story, memories, and special moments
- Any specific details to include

Carefully extract all relevant information from their request and use it to create deeply personalized lyrics. Follow your style guide, meet all checklist requirements, and write in the language and mood they've indicated (or default to Hindi/romantic if not specified).

Provide ONLY the lyrics with clear structure (Verse 1, Chorus, Verse 2, etc.). Do not include any preamble or explanation.`;

          const response = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt })
          });

          const data = await response.json();
          
          if (data.lyrics) {
            setGeneratedLyrics(data.lyrics);
            
            const newHistoryItem = {
              id: Date.now(),
              orderNumber: formData.orderNumber,
              lyrics: data.lyrics,
              request: formData.customerRequest,
              date: new Date().toISOString(),
              status: 'pending',
              feedback: null
            };
            setLyricsHistory([newHistoryItem, ...lyricsHistory]);
            setFormData({ customerRequest: '', orderNumber: '' });
          } else {
            alert('Error: ' + (data.error || 'Failed to generate lyrics'));
            setGeneratedLyrics('Error: Unable to generate lyrics. ' + (data.error || ''));
          }
        } catch (error) {
          alert('Error: ' + error.message);
          setGeneratedLyrics(`Error: ${error.message}`);
        }
        
        setIsGenerating(false);
      };

      const regenerateWithFeedback = async (lyric) => {
        setIsGenerating(true);
        setActiveTab('generate');
        
        try {
          const prompt = `You are an expert lyrics writer for Raaag, creating personalized songs for special occasions.

# YOUR STYLE GUIDE
${styleGuide || 'Not yet defined'}

# QUALITY CHECKLIST
${checklist || 'Not yet defined'}

# REFERENCE EXAMPLES
${exampleLyrics.length > 0 ? exampleLyrics.map((ex, i) => `
Example ${i + 1}: ${ex.title}
${ex.lyrics}
${ex.notes ? `Notes: ${ex.notes}` : ''}
`).join('\\n---\\n') : 'No examples added yet.'}

# CUSTOMER REQUEST
${lyric.request}

# PREVIOUS VERSION (NEEDS IMPROVEMENT)
${lyric.lyrics}

# FEEDBACK ON WHAT TO IMPROVE
${lyric.feedback || 'Please improve the quality and make it more personalized.'}

# TASK
The lyrics above were not satisfactory. Create a NEW and IMPROVED version based on the feedback. Make sure to address all the issues mentioned and create better, more personalized lyrics.

Provide ONLY the improved lyrics with clear structure. Do not include any preamble or explanation.`;

          const response = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt })
          });

          const data = await response.json();
          
          if (data.lyrics) {
            setGeneratedLyrics(data.lyrics);
            
            const newHistoryItem = {
              id: Date.now(),
              orderNumber: lyric.orderNumber + '-R',
              lyrics: data.lyrics,
              request: lyric.request,
              date: new Date().toISOString(),
              status: 'pending',
              feedback: null,
              regeneratedFrom: lyric.id
            };
            setLyricsHistory([newHistoryItem, ...lyricsHistory]);
            
            alert('‚ú® New version generated! Check the output panel.');
          } else {
            alert('Error: ' + (data.error || 'Failed to regenerate'));
          }
        } catch (error) {
          alert('Error: ' + error.message);
        }
        
        setIsGenerating(false);
      };

      const copyLyrics = (lyrics) => {
        navigator.clipboard.writeText(lyrics.trim()).then(() => {
          alert('‚úÖ Lyrics copied to clipboard!');
        }).catch(() => {
          alert('‚ùå Failed to copy lyrics');
        });
      };

      const exportLyrics = (lyrics, filename) => {
        const blob = new Blob([lyrics], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename || 'lyrics.txt';
        a.click();
        URL.revokeObjectURL(url);
      };

      const openFeedbackModal = (lyric, type) => {
        setFeedbackModal({ open: true, lyric, type });
        setFeedbackNotes('');
        setFeedbackTitle('');
      };

      const submitFeedback = () => {
        if (feedbackModal.type === 'good') {
          const updatedHistory = lyricsHistory.map(item => 
            item.id === feedbackModal.lyric.id 
              ? { ...item, status: 'good', feedback: feedbackNotes }
              : item
          );
          setLyricsHistory(updatedHistory);
          
          if (feedbackTitle && feedbackNotes) {
            const newExample = {
              id: Date.now(),
              title: feedbackTitle,
              lyrics: feedbackModal.lyric.lyrics,
              notes: feedbackNotes
            };
            setExampleLyrics([...exampleLyrics, newExample]);
          }
          
          alert('‚úÖ Marked as good! Added to training examples.');
        } else if (feedbackModal.type === 'bad') {
          const updatedHistory = lyricsHistory.map(item => 
            item.id === feedbackModal.lyric.id 
              ? { ...item, status: 'bad', feedback: feedbackNotes }
              : item
          );
          setLyricsHistory(updatedHistory);
          
          alert('üìù Feedback saved! Use this to improve your style guide or regenerate with notes.');
        }
        
        setFeedbackModal({ open: false, lyric: null, type: null });
      };

      const getAnalytics = () => {
        const dateMap = {};
        
        lyricsHistory.forEach(item => {
          const date = new Date(item.date).toLocaleDateString();
          if (!dateMap[date]) {
            dateMap[date] = { total: 0, pending: 0, good: 0, bad: 0 };
          }
          dateMap[date].total++;
          dateMap[date][item.status]++;
        });
        
        return Object.entries(dateMap)
          .map(([date, stats]) => ({ date, ...stats }))
          .sort((a, b) => new Date(b.date) - new Date(a.date));
      };

      const getFilteredLyrics = (status = null) => {
        let filtered = status ? lyricsHistory.filter(l => l.status === status) : lyricsHistory;
        
        if (searchQuery.trim()) {
          const query = searchQuery.toLowerCase().trim();
          filtered = filtered.filter(item => 
            item.orderNumber.toString().toLowerCase().includes(query) ||
            item.request.toLowerCase().includes(query) ||
            item.lyrics.toLowerCase().includes(query) ||
            new Date(item.date).toLocaleDateString().includes(query)
          );
        }
        
        return filtered;
      };

      const pendingLyrics = getFilteredLyrics('pending');
      const goodLyrics = getFilteredLyrics('good');
      const badLyrics = getFilteredLyrics('bad');
      const allFilteredLyrics = getFilteredLyrics();

      return (
        <div className="min-h-screen p-4 md:p-6">
          <div className="max-w-7xl mx-auto">
            <div className="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-6 fade-in">
              <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                <div className="flex items-center gap-3">
                  <div className="text-4xl">üéµ</div>
                  <div>
                    <h1 className="text-2xl md:text-3xl font-bold text-gray-800">Raaag AI Lyrics Generator</h1>
                    <p className="text-gray-600 text-sm md:text-base">Your personalized AI-powered lyrics creation tool</p>
                  </div>
                </div>
                <div className="flex gap-4 text-sm">
                  <div className="text-center">
                    <div className="text-2xl font-bold text-yellow-600">{lyricsHistory.filter(l => l.status === 'pending').length}</div>
                    <div className="text-gray-600">Pending</div>
                  </div>
                  <div className="text-center">
                    <div className="text-2xl font-bold text-green-600">{lyricsHistory.filter(l => l.status === 'good').length}</div>
                    <div className="text-gray-600">Approved</div>
                  </div>
                  <div className="text-center">
                    <div className="text-2xl font-bold text-red-600">{lyricsHistory.filter(l => l.status === 'bad').length}</div>
                    <div className="text-gray-600">Needs Work</div>
                  </div>
                </div>
              </div>
            </div>

            <div className="bg-white rounded-lg shadow-lg mb-6">
              <div className="flex border-b overflow-x-auto">
                {[
                  { id: 'dashboard', label: 'Dashboard', icon: 'üìä' },
                  { id: 'generate', label: 'Generate', icon: '‚ú®' },
                  { id: 'history', label: `History (${lyricsHistory.length})`, icon: 'üìù' },
                  { id: 'settings', label: 'Settings', icon: '‚öôÔ∏è' }
                ].map(tab => (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className={`flex items-center gap-2 px-4 md:px-6 py-4 font-medium transition-colors whitespace-nowrap ${
                      activeTab === tab.id
                        ? 'text-purple-600 border-b-2 border-purple-600'
                        : 'text-gray-600 hover:text-purple-600'
                    }`}
                  >
                    <span>{tab.icon}</span>
                    <span className="hidden sm:inline">{tab.label}</span>
                  </button>
                ))}
              </div>
            </div>
{activeTab === 'dashboard' && (
              <div className="space-y-6 fade-in">
                <div className="grid grid-cols-1 md:grid-cols-4 gap-4 md:gap-6">
                  {[
                    { label: 'Total Lyrics', value: lyricsHistory.length, color: 'gray', icon: 'üìù' },
                    { label: 'Pending Review', value: lyricsHistory.filter(l => l.status === 'pending').length, color: 'yellow', icon: '‚è≥' },
                    { label: 'Approved', value: lyricsHistory.filter(l => l.status === 'good').length, color: 'green', icon: '‚úÖ' },
                    { label: 'Needs Work', value: lyricsHistory.filter(l => l.status === 'bad').length, color: 'red', icon: '‚ùå' }
                  ].map((stat, idx) => (
                    <div key={idx} className="bg-white rounded-lg shadow-lg p-6">
                      <div className="flex items-center justify-between mb-2">
                        <h3 className="text-gray-600 text-sm font-medium">{stat.label}</h3>
                        <span className="text-2xl">{stat.icon}</span>
                      </div>
                      <div className={`text-3xl font-bold text-${stat.color}-600`}>{stat.value}</div>
                    </div>
                  ))}
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Date-wise Analytics</h2>
                  {lyricsHistory.length === 0 ? (
                    <p className="text-gray-500 text-center py-8">No data yet. Start generating lyrics!</p>
                  ) : (
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead>
                          <tr className="border-b-2 border-gray-200">
                            <th className="text-left py-3 px-4 font-semibold text-gray-700">Date</th>
                            <th className="text-center py-3 px-4 font-semibold text-gray-700">Total</th>
                            <th className="text-center py-3 px-4 font-semibold text-yellow-700">Pending</th>
                            <th className="text-center py-3 px-4 font-semibold text-green-700">Approved</th>
                            <th className="text-center py-3 px-4 font-semibold text-red-700">Needs Work</th>
                          </tr>
                        </thead>
                        <tbody>
                          {getAnalytics().map((row, index) => (
                            <tr key={index} className="border-b border-gray-100 hover:bg-gray-50">
                              <td className="py-3 px-4 font-medium text-gray-800">{row.date}</td>
                              <td className="py-3 px-4 text-center text-gray-800">{row.total}</td>
                              <td className="py-3 px-4 text-center text-yellow-600">{row.pending}</td>
                              <td className="py-3 px-4 text-center text-green-600">{row.good}</td>
                              <td className="py-3 px-4 text-center text-red-600">{row.bad}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  )}
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">üîç Search Lyrics</h2>
                  <input
                    type="text"
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    placeholder="Search by order number, date, or content..."
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-4"
                  />
                  {searchQuery && (
                    <div>
                      <p className="text-sm text-gray-600 mb-4">
                        Found {allFilteredLyrics.length} results for "{searchQuery}"
                      </p>
                      <div className="space-y-3">
                        {allFilteredLyrics.length === 0 ? (
                          <p className="text-gray-500 text-center py-8">No results found</p>
                        ) : (
                          allFilteredLyrics.slice(0, 10).map((item) => (
                            <div key={item.id} className="border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition-colors">
                              <div className="flex justify-between items-start">
                                <div className="flex items-center gap-2 flex-wrap">
                                  <span className="px-3 py-1 bg-purple-100 text-purple-800 text-sm font-bold rounded">
                                    #{item.orderNumber}
                                  </span>
                                  {item.status === 'pending' && (
                                    <span className="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded">
                                      Pending
                                    </span>
                                  )}
                                  {item.status === 'good' && (
                                    <span className="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded">
                                      Approved
                                    </span>
                                  )}
                                  {item.status === 'bad' && (
                                    <span className="px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded">
                                      Needs Work
                                    </span>
                                  )}
                                  <span className="text-sm text-gray-500">
                                    {new Date(item.date).toLocaleDateString()}
                                  </span>
                                </div>
                                <button
                                  onClick={() => setActiveTab('history')}
                                  className="text-purple-600 hover:text-purple-700 text-sm font-medium"
                                >
                                  View ‚Üí
                                </button>
                              </div>
                              <p className="text-sm text-gray-600 mt-2">{item.request.substring(0, 100)}...</p>
                            </div>
                          ))
                        )}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}

            {activeTab === 'generate' && (
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 fade-in">
                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Customer Request</h2>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Order Number <span className="text-red-500">*</span>
                      </label>
                      <input
                        type="text"
                        value={formData.orderNumber}
                        onChange={(e) => setFormData({...formData, orderNumber: e.target.value})}
                        placeholder="e.g., ORD-2024-001 or 1234"
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      />
                      <p className="text-xs text-gray-500 mt-1">
                        Enter your internal order number for tracking
                      </p>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Customer Request <span className="text-red-500">*</span>
                      </label>
                      <textarea
                        value={formData.customerRequest}
                        onChange={(e) => setFormData({...formData, customerRequest: e.target.value})}
                        placeholder="Example: Hi, I want a romantic birthday song for my wife Priya..."
                        rows="14"
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      />
                      <p className="text-xs text-gray-500 mt-2">
                        üí° Include: occasion, names, relationship, language, mood, memories
                      </p>
                    </div>
                    <button
                      onClick={generateLyrics}
                      disabled={isGenerating || !formData.customerRequest || !formData.orderNumber}
                      className="w-full bg-purple-600 text-white py-3 rounded-lg font-medium hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    >
                      {isGenerating ? (
                        <>
                          <div className="loading-spinner"></div>
                          Generating...
                        </>
                      ) : (
                        '‚ú® Generate Lyrics'
                      )}
                    </button>
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6">
                  <div className="flex justify-between items-center mb-4 flex-wrap gap-2">
                    <h2 className="text-xl font-bold text-gray-800">Generated Lyrics</h2>
                    {generatedLyrics && (
                      <div className="flex gap-2">
                        <button
                          onClick={() => copyLyrics(generatedLyrics)}
                          className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm"
                        >
                          üìã Copy
                        </button>
                        <button
                          onClick={() => exportLyrics(generatedLyrics, `order-${lyricsHistory[0]?.orderNumber}-lyrics.txt`)}
                          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm"
                        >
                          üíæ Export
                        </button>
                      </div>
                    )}
                  </div>
                  {generatedLyrics ? (
                    <div>
                      <div className="bg-gray-50 rounded-lg p-4 mb-4 max-h-96 overflow-y-auto whitespace-pre-wrap text-sm">
                        {generatedLyrics}
                      </div>
                      <div className="text-sm bg-blue-50 p-3 rounded-lg">
                        ‚ÑπÔ∏è Auto-saved as Order #{lyricsHistory[0]?.orderNumber || 'N/A'}
                      </div>
                    </div>
                  ) : (
                    <div className="bg-gray-50 rounded-lg p-8 h-96 flex items-center justify-center">
                      <div className="text-center text-gray-400">
                        <div className="text-6xl mb-4">üéµ</div>
                        <p>Your generated lyrics will appear here</p>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}

            {activeTab === 'history' && (
              <div className="space-y-6 fade-in">
                <div className="bg-white rounded-lg shadow-lg p-4">
                  <div className="flex gap-2 md:gap-4 overflow-x-auto">
                    <button
                      onClick={() => setActiveTab('history')}
                      className="px-4 py-2 bg-yellow-100 text-yellow-800 rounded-lg font-medium whitespace-nowrap text-sm md:text-base"
                    >
                      Pending ({pendingLyrics.length})
                    </button>
                    <button
                      onClick={() => setActiveTab('history-good')}
                      className="px-4 py-2 bg-green-100 text-green-800 rounded-lg font-medium whitespace-nowrap text-sm md:text-base"
                    >
                      Approved ({goodLyrics.length})
                    </button>
                    <button
                      onClick={() => setActiveTab('history-bad')}
                      className="px-4 py-2 bg-red-100 text-red-800 rounded-lg font-medium whitespace-nowrap text-sm md:text-base"
                    >
                      Needs Work ({badLyrics.length})
                    </button>
                  </div>
                </div>

                <div className="space-y-4">
                  {(activeTab === 'history' ? pendingLyrics : 
                    activeTab === 'history-good' ? goodLyrics : badLyrics).length === 0 ? (
                    <div className="bg-white rounded-lg shadow-lg p-12 text-center text-gray-500">
                      <div className="text-6xl mb-4">üìù</div>
                      <p>No lyrics in this category yet</p>
                    </div>
                  ) : (
                    (activeTab === 'history' ? pendingLyrics : 
                      activeTab === 'history-good' ? goodLyrics : badLyrics).map((item) => (
                      <div key={item.id} className="bg-white rounded-lg shadow-lg p-4 md:p-6">
                        <div className="flex justify-between items-start mb-4 flex-wrap gap-2">
                          <div className="flex-1">
                            <div className="flex items-center gap-2 mb-2 flex-wrap">
                              <span className="px-3 py-1 bg-purple-600 text-white text-sm font-bold rounded">
                                Order #{item.orderNumber}
                              </span>
                              <span className="text-sm text-gray-500">
                                {new Date(item.date).toLocaleString()}
                              </span>
                            </div>
                            {item.feedback && (
                              <p className="text-sm text-gray-700 bg-blue-50 p-2 rounded">
                                <strong>Feedback:</strong> {item.feedback}
                              </p>
                            )}
                          </div>
                          <div className="flex gap-2">
                            <button
                              onClick={() => copyLyrics(item.lyrics)}
                              className="p-2 text-purple-600 hover:bg-purple-50 rounded"
                              title="Copy"
                            >
                              üìã
                            </button>
                            <button
                              onClick={() => exportLyrics(item.lyrics, `order-${item.orderNumber}.txt`)}
                              className="p-2 text-blue-600 hover:bg-blue-50 rounded"
                              title="Export"
                            >
                              üíæ
                            </button>
                            <button
                              onClick={() => {
                                if (confirm('Delete?')) {
                                  setLyricsHistory(lyricsHistory.filter(l => l.id !== item.id));
                                }
                              }}
                              className="p-2 text-red-600 hover:bg-red-50 rounded"
                              title="Delete"
                            >
                              üóëÔ∏è
                            </button>
                          </div>
                        </div>
                        
                        <pre className="text-sm bg-gray-50 p-4 rounded mb-4 max-h-64 overflow-y-auto whitespace-pre-wrap">
                          {item.lyrics}
                        </pre>

                        <div className="flex gap-2 flex-wrap">
                          {item.status === 'pending' && (
                            <>
                              <button
                                onClick={() => openFeedbackModal(item, 'good')}
                                className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm"
                              >
                                üëç Mark as Good
                              </button>
                              <button
                                onClick={() => openFeedbackModal(item, 'bad')}
                                className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm"
                              >
                                üëé Needs Work
                              </button>
                            </>
                          )}
                          {item.status === 'bad' && (
                            <button
                              onClick={() => regenerateWithFeedback(item)}
                              className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm"
                            >
                              üîÑ Regenerate
                            </button>
                          )}
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>
            )}

            {activeTab === 'settings' && (
              <div className="space-y-6 fade-in">
                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Style Guide</h2>
                  <p className="text-gray-600 mb-4">Define your unique writing style.</p>
                  <textarea
                    value={styleGuide}
                    onChange={(e) => setStyleGuide(e.target.value)}
                    placeholder="Example: Write in a conversational, warm tone..."
                    rows="8"
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                  />
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Quality Checklist</h2>
                  <p className="text-gray-600 mb-4">Requirements every song must meet.</p>
                  <textarea
                    value={checklist}
                    onChange={(e) => setChecklist(e.target.value)}
                    placeholder="- Include recipient's name&#10;- Clear verse-chorus structure..."
                    rows="10"
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                  />
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Reference Examples ({exampleLyrics.length})</h2>
                  
                  <div className="bg-purple-50 rounded-lg p-4 mb-4">
                    <h3 className="font-medium mb-3">Add New Example</h3>
                    <div className="space-y-3">
                      <input
                        type="text"
                        value={newExample.title}
                        onChange={(e) => setNewExample({...newExample, title: e.target.value})}
                        placeholder="Title"
                        className="w-full px-3 py-2 border rounded-lg"
                      />
                      <textarea
                        value={newExample.lyrics}
                        onChange={(e) => setNewExample({...newExample, lyrics: e.target.value})}
                        placeholder="Lyrics..."
                        rows="6"
                        className="w-full px-3 py-2 border rounded-lg"
                      />
                      <input
                        type="text"
                        value={newExample.notes}
                        onChange={(e) => setNewExample({...newExample, notes: e.target.value})}
                        placeholder="Notes"
                        className="w-full px-3 py-2 border rounded-lg"
                      />
                      <button
                        onClick={addExample}
                        disabled={!newExample.title || !newExample.lyrics}
                        className="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 disabled:bg-gray-400"
                      >
                        Add Example
                      </button>
                    </div>
                  </div>

                  <div className="space-y-3">
                    {exampleLyrics.length === 0 ? (
                      <p className="text-gray-500 text-center py-8">No examples yet</p>
                    ) : (
                      exampleLyrics.map((example) => (
                        <div key={example.id} className="border rounded-lg p-4">
                          <div className="flex justify-between mb-2">
                            <h4 className="font-medium">{example.title}</h4>
                            <button
                              onClick={() => deleteExample(example.id)}
                              className="text-red-600"
                            >
                              üóëÔ∏è
                            </button>
                          </div>
                          <pre className="text-sm bg-gray-50 p-3 rounded mb-2 whitespace-pre-wrap max-h-48 overflow-y-auto">
                            {example.lyrics}
                          </pre>
                          {example.notes && (
                            <p className="text-sm text-gray-500 italic">Notes: {example.notes}</p>
                          )}
                        </div>
                      ))
                    )}
                  </div>
                </div>
              </div>
            )}
          </div>

          {feedbackModal.open && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 md:p-6">
              <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-4 md:p-6">
                <h2 className="text-xl md:text-2xl font-bold mb-4">
                  {feedbackModal.type === 'good' ? '‚úÖ Mark as Good' : '‚ùå Needs Work'}
                </h2>
                
                <div className="mb-4 bg-gray-50 p-4 rounded max-h-48 overflow-y-auto">
                  <pre className="text-sm whitespace-pre-wrap">{feedbackModal.lyric?.lyrics}</pre>
                </div>

                {feedbackModal.type === 'good' ? (
                  <div className="space-y-4">
                    <input
                      type="text"
                      value={feedbackTitle}
                      onChange={(e) => setFeedbackTitle(e.target.value)}
                      placeholder="Title (optional)"
                      className="w-full px-3 py-2 border rounded-lg"
                    />
                    <textarea
                      value={feedbackNotes}
                      onChange={(e) => setFeedbackNotes(e.target.value)}
                      placeholder="Why did this work well?"
                      rows="4"
                      className="w-full px-3 py-2 border rounded-lg"
                    />
                  </div>
                ) : (
                  <textarea
                    value={feedbackNotes}
                    onChange={(e) => setFeedbackNotes(e.target.value)}
                    placeholder="What needs improvement?"
                    rows="6"
                    className="w-full px-3 py-2 border rounded-lg"
                  />
                )}

                <div className="flex gap-3 mt-6 flex-col sm:flex-row">
                  <button
                    onClick={submitFeedback}
                    className={`flex-1 py-2 rounded-lg text-white font-medium ${
                      feedbackModal.type === 'good' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'
                    }`}
                  >
                    Submit
                  </button>
                  <button
                    onClick={() => setFeedbackModal({ open: false, lyric: null, type: null })}
                    className="px-6 py-2 bg-gray-300 rounded-lg hover:bg-gray-400 font-medium"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
